function [lbpf]=IMG2LBP(im, cellheight, cellwidth)

%LBP preparation
% unipats = uniform_pattern(8)';
% np = size(unipats,1)+1;
% map = np*ones(2^8,1);
% map(1+unipats) = [1:np-1]';

np = 59;
map = [1;2;3;4;5;59;6;7;8;59;59;59;9;59;10;11;12;59;59;59;59;59;59;59;13;59;59;59;14;59;15;16;17;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;18;59;59;59;59;59;59;59;19;59;59;59;20;59;21;22;23;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;24;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;25;59;59;59;59;59;59;59;26;59;59;59;27;59;28;29;30;31;59;32;59;59;59;33;59;59;59;59;59;59;59;34;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;35;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;36;37;38;59;39;59;59;59;40;59;59;59;59;59;59;59;41;59;59;59;59;59;59;59;59;59;59;59;59;59;59;59;42;43;44;59;45;59;59;59;46;59;59;59;59;59;59;59;47;48;49;59;50;59;59;59;51;52;53;59;54;55;56;57;58];
    % LBP feature extraction
    lbp = lbp_image(double(im),'P8R2');
    lbp = map(1+lbp);
    h = lbp_histo([1:np]',im2col(lbp,[cellheight cellwidth],'distinct')); 
    lbpf = reshape(h, size(h,1)*size(h,2), 1);
%     lbpf = sqrt(lbpf);
%    lbpf = lbpf-mean(lbpf); 
%     lbpf = lbpf/norm(lbpf);
